language: android
jdk:
  - oraclejdk8
android:
  components:
    - tools
install:
  - echo 'count=0' > /home/travis/.android/repositories.cfg # every step yields this meaningless error message
  - echo y | sdkmanager "platform-tools" >/dev/null # discard output or else the build will fail
  - echo y | sdkmanager "tools" >/dev/null
  - echo y | sdkmanager "build-tools;29.0.2" >/dev/null
  - echo y | sdkmanager "platforms;android-29" >/dev/null
  - echo y | sdkmanager "emulator" >/dev/null
  - echo y | sdkmanager "system-images;android-29;default;x86_64" >/dev/null
  - echo no | avdmanager create avd --force -n test -k "system-images;android-29;default;x86_64" -c 10M
  - emulator -verbose -avd test -no-accel -no-snapshot -no-window -no-audio -camera-back none -camera-front none -selinux permissive -qemu -m 2048 &
  - android-wait-for-emulator
  - adb shell input keyevent 82 &
after_success:
  - ./gradlew createDebugCoverageReport coveralls
